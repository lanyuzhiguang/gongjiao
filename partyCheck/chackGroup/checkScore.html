<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../../css/checkScore.css">
    <link rel="stylesheet" type="text/css" href="../../css/layui.css">
    <link rel="stylesheet" type="text/css" href="../../css/laydate.css">
    <link rel="stylesheet" type="text/css" href="../../css/layer.css">
    <link rel="stylesheet" type="text/css" href="../../css/zTreeStyle.css">
    <style>
        .noActive {
            background: #cdd4d6 !important;
            color: #616161 !important;
        }
        
        .hid {
            display: none;
        }
        
        .hibinenState {
            color: #bcbcbc !important;
            cursor: not-allowed !important;
        }
        
        #pageContent,
        #pageContent1 {
            margin: auto;
            text-align: center;
            margin-top: 47px;
        }
        
        .noDate,
        .noDate1 {
            text-align: center;
            font-size: 14px;
        }
        
        .noDate,
        #wu,
        #zanWu {
            text-align: center;
            font-size: 14px;
        }
        
        .hid {
            display: none;
        }
        
        .ztree li span.button.chk.checkbox_true_disable {
            background-position: -14px 0px;
        }
        
        .btnList input:last-of-type {
            background: #fff;
        }
    </style>
</head>

<body>
    <div>
        <div class="rulesHead">
            <ul id="biaoQ">
                <li id="organizationLi">党组织考核评分</li>
                <li id="partyMemberLi" class="noActive">党员考核评分</li>
            </ul>
            <div style="clear:both;"></div>
            <div class="partyMember hid">
                <div class="topInput">
                    <div>考核规则发布单位</div>
                    <div><input type="text" id="partyMOffice"></div>
                    <div>考核类别</div>
                    <div class="kaoPKind">
                        <input type="hidden" id="partyKId">
                        <input type="text" readonly="readonly" id="membeiKind"><img src="../../img/select.png">
                        <div id="PartyMKind" class="selectPartyBtn" style="display: none">
                            <ul>
                                <li data-id="">全部</li>
                                <li data-id="1">党员</li>
                                <li data-id="2">干部</li>
                            </ul>
                        </div>
                    </div>
                    <div>考核状态</div>
                    <div class="rulesPartyKind">
                        <input type="hidden" value="" id="ruleP">
                        <input type="text" id="partyState" readonly="readonly"><img src="../../img/select.png">
                        <div id="partyMState" class="PartyMrulerBtn" style="display: none">
                            <ul>
                                <li data-id="">全部</li>
                                <li data-id="1">考核中</li>
                                <li data-id="2">考核完毕</li>
                            </ul>
                        </div>
                    </div>
                    <!--<div class="createRule" id="orgaCheck">创建规则</div>-->
                    <div class="searchB">查询</div>

                </div>
                <div class="tableList">
                    <table cellpadding="0" cellspacing="0">
                        <thead>
                            <tr>
                                <th style="">序号</th>
                                <th style="">标题</th>
                                <th style="">考核发布单位</th>
                                <th style="width:10%">考核适用范围</th>
                                <th style="width: 6%">考核类别</th>
                                <th style="width: 12%">考核周期</th>
                                <th style="width: 10%">考核单位总数</th>
                                <th style="width: 10%">已填报数量</th>
                                <th style="width: 10%">已考核数量</th>
                                <th style="width: 10%">考核状态</th>
                                <th style="">操作</th>
                            </tr>

                        </thead>
                        <tbody id="talkR1">
                        </tbody>
                    </table>
                    <div class="noDate1 hid">暂无数据</div>
                </div>
                <div id="pageContent1"></div>
            </div>
            <div class="partyOrganization">
                <div class="topInput">
                    <div>考核规则发布单位</div>
                    <div><input id="publishOffice" type="text"></div>
                    <div>考核类别</div>
                    <div class="kaoKind">
                        <input type="hidden" value="" id="orgaKind">
                        <input type="text" id="organizationL" readonly="readonly"><img src="../../img/select.png">
                        <div id="checkKind" class="selectBtn" style="display: none">
                            <ul>
                                <li data-id="">全部</li>
                                <li data-id="1">党委</li>
                                <li data-id="2">党工委</li>
                                <li data-id="3">党总支</li>
                                <li data-id="4">党支部</li>
                                <li data-id="5">联合党支部</li>
                            </ul>
                        </div>
                    </div>
                    <div>考核状态</div>
                    <div class="rulesKind">
                        <input type="hidden" value="" id="rule">
                        <input type="text" id="ruleB" readonly="readonly"><img src="../../img/select.png">
                        <div id="rulerState" class="rulerBtn" style="display: none">
                            <ul>
                                <li data-id="">全部</li>
                                <li data-id="1">考核中</li>
                                <li data-id="2">考核完毕</li>
                            </ul>
                        </div>
                    </div>
                    <!--<div class="createRule" id="createOrga">创建规则</div>-->
                    <div id="organizationSear">查询</div>

                </div>
                <div class="tableList">
                    <table cellpadding="0" cellspacing="0">
                        <thead>
                            <tr>
                                <th style="">序号</th>
                                <th style="">标题</th>
                                <th style="">考核发布单位</th>
                                <th style="width:10%">考核适用范围</th>
                                <th style="width: 6%">考核类别</th>
                                <th style="width: 12%">考核周期</th>
                                <th style="width: 10%">考核单位总数</th>
                                <th style="width: 10%">已填报数量</th>
                                <th style="width: 10%">已考核数量</th>
                                <th style="width: 10%">考核状态</th>
                                <th style="">操作</th>
                            </tr>
                        </thead>
                        <tbody id="talkR">
                        </tbody>
                    </table>
                    <div class="noDate hid">暂无数据</div>
                </div>
                <div id="pageContent"></div>
            </div>

        </div>

    </div>
    <div class="mask hid"></div>
    <div class="popBox hid " id="poper1">
        <div class="popB_Top">
            <span class="addW" id="titleC">考核适用范围</span><span class="close" id="close"><img src="../../img/close.png"></span>
        </div>
        <div class="treeList">
            <div id="menuContent1" class="menuContent">
                <ul id="treeDemo1" class="ztree" style="margin-top:0; width:206px;margin: auto;"></ul>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../../r/wx/common/pathimage"></script>
<script src="../../assets/js/jquery.js"></script>
<script src="../../js/layer.js"></script>
<script src="../../js/laydate.js"></script>
<script src="../../js/layui.js"></script>
<script src="../../js/jquery.ztree.core.min.js"></script>
<script src="../../js/jquery.ztree.excheck.min.js"></script>
<script>
    $(function() {
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURI(r[2]);
            return null;
        }

        var recId = getQueryString("recId");
        var path = _ctxPath; //获取项目名称  即如 /dangjian    /项目名  ---》 这个跟在服务器里面配置的有关
        $("#organizationLi").click(function() {
            $(this).removeClass("noActive");
            $("#partyMemberLi").addClass("noActive");
            $(".partyMember").addClass("hid");
            $(".partyOrganization").removeClass("hid");
            partyOrganize();
        });
        $("#partyMemberLi").click(function() {
            $(this).removeClass("noActive");
            $("#organizationLi").addClass("noActive");
            $(".partyMember").removeClass("hid");
            $(".partyOrganization").addClass("hid");
            partyMember();
        });
        partyOrganize();
        //党员考核类别
        $(".kaoPKind>input,.kaoPKind>img").click(function(e) {
            $("#PartyMKind").slideDown();
            $("#partyMState").slideUp();
            e.stopPropagation();
        });
        $(".selectPartyBtn ul li").mouseover(function() {
            $(".selectPartyBtn ul li").removeClass("activeSelcet");
            $(this).addClass("activeSelcet");
        });
        $("body").click(function() {
            $(".selectPartyBtn").slideUp();
        });
        $(".selectPartyBtn ul li").click(function() {
            $(this).parents(".selectPartyBtn").prevAll("#membeiKind").val($(this).text());
            $(this).parents(".selectPartyBtn").prevAll("#membeiKind").prev().val($(this).attr("data-id"));
            $("#PartyMKind").slideUp();
        });
        //党员规则状态
        $(".rulesPartyKind>input,.rulesPartyKind>img").click(function(e) {
            $("#partyMState").slideDown();
            $("#PartyMKind").slideUp();
            e.stopPropagation();
        });
        $(".PartyMrulerBtn ul li").mouseover(function() {
            $(".PartyMrulerBtn ul li").removeClass("activeSelcet");
            $(this).addClass("activeSelcet");
        });
        $("body").click(function() {
            $(".PartyMrulerBtn").slideUp();
        });
        $(".PartyMrulerBtn ul li").click(function() {
            $(this).parents(".PartyMrulerBtn").prevAll("#partyState").val($(this).text());
            $(this).parents(".PartyMrulerBtn").prevAll("#partyState").prev().val($(this).attr("data-id"));
            $("#partyMState").slideUp();
        });
        //党组织考核类别
        $(".kaoKind>input,.kaoKind>img").click(function(e) {
            $("#checkKind").slideDown();
            $("#rulerState").slideUp();
            e.stopPropagation();
        });
        $(".selectBtn ul li").mouseover(function() {
            $(".selectBtn ul li").removeClass("activeSelcet");
            $(this).addClass("activeSelcet");
        });
        $("body").click(function() {
            $(".selectBtn").slideUp();
        });
        $(".selectBtn ul li").click(function() {
            $(this).parents(".selectBtn").prevAll("#organizationL").val($(this).text());
            $(this).parents(".selectBtn").prevAll("#organizationL").prev().val($(this).attr("data-id"));
            $("#checkKind").slideUp();
        });

        //党组织规则状态
        $(".rulesKind>input,.rulesKind>img").click(function(e) {
            $("#rulerState").slideDown();
            $("#checkKind").slideUp();
            e.stopPropagation();
        });
        $(".rulerBtn ul li").mouseover(function() {
            $(".rulerBtn ul li").removeClass("activeSelcet");
            $(this).addClass("activeSelcet");
        });
        $("body").click(function() {
            $(".rulerBtn").slideUp();
        });
        $(".rulerBtn ul li").click(function() {
            $(this).parents(".rulerBtn").prevAll("#ruleB").val($(this).text());
            $(this).parents(".rulerBtn").prevAll("#ruleB").prev().val($(this).attr("data-id"));
            $("#rulerState").slideUp();
        });
        $("#organizationSear").click(function() {
            $('#talkR').empty();
            partyOrganize();
        });
        $(".searchB").click(function() {
            $('#talkR1').empty();
            partyMember();
        });

        function partyOrganize(type) {

            //分页参数设置 这些全局变量关系到分页的功能
            var pagea = 1; //开始页数
            var sizea = 10; //每页最多显示条数
            var nowpagea = 1; //当前页数
            var pagesa = 0; //总页数
            function page() {
                //调用分页
                layui.use(['laypage', 'layer'], function() {
                    var laypage = layui.laypage,
                        layer = layui.layer;
                    laypage.render({
                        elem: 'pageContent',
                        count: pagesa,
                        limit: sizea //每页显示的数据的条数,layui会根据count，limit进行分页的计算
                            ,
                        curr: nowpagea,
                        jump: function(obj, first) {
                            // var currPage=obj.curr;
                            // var perPage_num=obj.limit;
                            nowpagea = obj.curr;
                            pagea = (obj.curr - 1) * sizea;
                            if (!first) { //一定要加此判断，否则初始时会无限刷新
                                pageAjax(); //一定要把翻页的ajax请求放到这里，不然会请求两次。
                                location.href = '#top';
                                //<a href="#top">返回顶部</a>
                            }

                        }

                    });
                })
            }

            pageAjax();

            function pageAjax() {
                $.ajax({
                    type: "POST",
                    url: path + "partyCheck/queryScore.action",
                    data: {
                        "type|integer": 3,
                        "checkType|integer": $("#orgaKind").val(),
                        "regex:bumenName": $("#publishOffice").val(),
                        "stats|integer": $("#rule").val(),
                        "page": nowpagea, //当前页数
                        "size": sizea //每页显示条数
                    },
                    dataType: "json",
                    success: function(data) {
                        pagea = data.page; //当前页数(后台返回)
                        pagesa = data.total; //总页数(后台返回)
                        var data = data.data;
                        if (data.length == 0) {
                            $(".noDate").removeClass("hid");
                            $("#pageContent").addClass("hid");
                        } else {
                            handleData(data);
                            $(".noDate").addClass("hid");
                            $("#pageContent").removeClass("hid");
                        }
                        page();
                    }
                });
            }

            function handleData(data) {
                $('#talkR').empty();
                var stats = "";
                var lookStatus = "";
                for (var i = 0; i < data.length; i++) {
                    if (data[i].checkType == 1) {
                        checkType = "党委"
                    }
                    if (data[i].checkType == 2) {
                        checkType = "党工委"
                    }
                    if (data[i].checkType == 3) {
                        checkType = "党总支"
                    }
                    if (data[i].checkType == 4) {
                        checkType = "党支部"
                    }
                    if (data[i].checkType == 5) {
                        checkType = "联合党支部"
                    }
                    if (data[i].stats == 1) {
                        stats = "考核中";
                        lookStatus = "考评";
                    }
                    if (data[i].stats == 2) {
                        stats = "考核完毕";
                        lookStatus = "查看";
                    }
                    if (data[i].ckType == 0) {
                        var oTr = '<tr>\n' +
                            '                        <td>' + (i + 1) + '</td>\n' +
                            '                        <td><a style="color: #2196f3;" href="lookRegular.html?id=' + data[i]._id + '&&me=党组织">' + data[i].title + '</a></td>\n' +
                            '                        <td>' + data[i].bumenName + '</td>\n' +
                            '                        <td><input type="hidden" class="checkType" value=' + data[i].checkType + '><input type="hidden" class="bumenId" value=' + data[i].bumenId + '><input type="hidden" class="id" value=' + data[i]._id + '><span class="lookOne">查看</span></td>\n' +
                            '                        <td>' + checkType + '</td>\n';
                        if (data[i].formtStarCycle != "") {
                            oTr = oTr + '<td>' + data[i].formtStarCycle + '到' + data[i].formtEndCycle + '</td>\n';
                        } else {
                            oTr = oTr + '<td></td>';
                        }
                        oTr = oTr + '                        <td>' + data[i].adSum + '</td>\n' +
                            '                        <td>' + data[i].subSum + '</td>\n' +
                            '                        <td>' + data[i].adedSum + '</td>\n' +
                            '                        <td>' + stats + '</td>\n' +
                            '                        <td><input class="title" type="hidden" value=' + data[i].title + '><input class="id" type="hidden" value=' + data[i]._id + '><span class="look">' + lookStatus + '</span></td>\n' +
                            '                    </tr>';
                    } else {
                        if (data[i].ckType == 1) {
                            ckType = "全部党委";
                        }
                        if (data[i].ckType == 2) {
                            ckType = "全部党总支";
                        }
                        if (data[i].ckType == 3) {
                            ckType = "全部党支部";
                        }
                        var oTr = '<tr>\n' +
                            '                        <td>' + (i + 1) + '</td>\n' +
                            '                        <td><a style="color: #2196f3;" href="lookRegular.html?id=' + data[i]._id + '&&me=党组织">' + data[i].title + '</a></td>\n' +
                            '                        <td>' + data[i].bumenName + '</td>\n' +
                            '                        <td>' + ckType + '</td>\n' +
                            '                        <td>' + checkType + '</td>\n';
                        if (data[i].formtStarCycle != "") {
                            oTr = oTr + '                        <td>' + data[i].formtStarCycle + '到' + data[i].formtEndCycle + '</td>\n';
                        } else {
                            oTr = oTr + '<td></td>';
                        }
                        oTr = oTr + '                        <td>' + data[i].adSum + '</td>\n' +
                            '                        <td>' + data[i].subSum + '</td>\n' +
                            '                        <td>' + data[i].adedSum + '</td>\n' +
                            '                        <td>' + stats + '</td>\n' +
                            '                        <td><input class="title" type="hidden" value=' + data[i].title + '><input type="hidden" class="id" value=' + data[i]._id + '><span class="look">' + lookStatus + '</span></td>\n' +
                            '                    </tr>';
                    }

                    $('#talkR').append(oTr);
                }

                $('#talkR').on("click", function(e) {
                    var target = e.target;
                    var checkType = $(target).parent().find(".checkType").val();
                    var bumenId = $(target).parent().find(".bumenId").val();
                    var currId = $(target).parent().find(".id").val();
                    var title = $(target).parent().find(".title").val();
                    if ($(target).text() == "考评") {
                        window.location.href = "pingFLook.html?id=" + currId + "&&me=党组织&&title=" + title;
                    }
                    if ($(target).text() == "查看" && $(target).attr("class") == "look") {
                        window.location.href = "pingFLook.html?id=" + currId + "&&me=党组织&&title=" + title;
                    }
                    if ($(target).text() == "查看" && $(target).attr("class") == "lookOne") {
                        $("#poper1").removeClass("hid");
                        $(".mask").removeClass("hid");
                        var zNodes = [];
                        //tree
                        var setting = {
                            view: {
                                dblClickExpand: false
                            },
                            data: {
                                simpleData: {
                                    enable: true,
                                    idKey: "id",
                                    pIdKey: "pId"
                                },
                                key: {
                                    name: "name"
                                }
                            },
                            check: {
                                enable: true,
                                chkDisabledInherit: true,
                                chkStyle: "checkbox",
                                chkboxType: {
                                    "Y": "",
                                    "N": ""
                                }
                            },
                            callback: {}
                        };
                        buildTree();

                        function buildTree() {
                            $.ajax({
                                type: "POST",
                                url: path + "partyCheck/findCheckBums.action",
                                data: {
                                    "checkId": currId,
                                    "bumenId": bumenId,
                                    "checkType": checkType
                                },
                                dataType: "json",
                                success: function(data) {
                                    var data = data.data;
                                    if (data) {
                                        zNodes = data;
                                        var zTree = $.fn.zTree.init($("#treeDemo1"), setting, zNodes);
                                        var node = zTree.getNodeByParam("id", 0);
                                        //alert(JSON.stringify(node));
                                        zTree.selectNode(node);
                                        zTree.expandNode(node, true, false, false);
                                        var treeObj = $.fn.zTree.getZTreeObj("treeDemo1");
                                        treeObj.expandAll(true);
                                    }
                                    hibb_Nodes();

                                }
                            });
                        }


                        $("#cancel").click(function() {
                            $("#poper1").addClass("hid");
                            $(".mask").addClass("hid");
                        });
                        $("#close").click(function() {
                            $("#poper1").addClass("hid");
                            $(".mask").addClass("hid");
                        });
                        $(".mask").click(function() {
                            $("#poper1").addClass("hid");
                            $(".mask").addClass("hid");
                        });
                        $("#sure").click(function() {
                            $("#poper1").addClass("hid");
                            $(".mask").addClass("hid");

                        });

                        function hibb_Nodes() {
                            var treeObj = $.fn.zTree.getZTreeObj("treeDemo1");
                            var nodes = treeObj.transformToArray(treeObj.getNodes());
                            for (var node in nodes) {
                                treeObj.setChkDisabled(nodes[node], true);
                            }
                        }
                    }

                })
            }
        }

        function partyMember(type) {

            //分页参数设置 这些全局变量关系到分页的功能
            var pagea = 1; //开始页数
            var sizea = 10; //每页最多显示条数
            var nowpagea = 1; //当前页数
            var pagesa = 0; //总页数
            function page() {
                //调用分页
                layui.use(['laypage', 'layer'], function() {
                    var laypage = layui.laypage,
                        layer = layui.layer;
                    laypage.render({
                        elem: 'pageContent1',
                        count: pagesa,
                        limit: sizea //每页显示的数据的条数,layui会根据count，limit进行分页的计算
                            ,
                        curr: nowpagea,
                        jump: function(obj, first) {
                            // var currPage=obj.curr;
                            // var perPage_num=obj.limit;
                            nowpagea = obj.curr;
                            pagea = (obj.curr - 1) * sizea;
                            if (!first) { //一定要加此判断，否则初始时会无限刷新
                                pageAjax(); //一定要把翻页的ajax请求放到这里，不然会请求两次。
                                location.href = '#top';
                                //<a href="#top">返回顶部</a>
                            }

                        }

                    });
                })
            }

            pageAjax();

            function pageAjax() {
                $.ajax({
                    type: "POST",
                    url: path + "partyCheck/queryScore.action",
                    data: {
                        "type|integer": 4,
                        "checkType|integer": $("#partyKId").val(),
                        "regex:bumenName": $("#partyMOffice").val(),
                        "stats|integer": $("#ruleP").val(),
                        "page": nowpagea, //当前页数
                        "size": sizea //每页显示条数
                    },
                    dataType: "json",
                    success: function(data) {
                        pagea = data.page; //当前页数(后台返回)
                        pagesa = data.total; //总页数(后台返回)
                        var data = data.data;
                        if (data.length == 0) {
                            $(".noDate1").removeClass("hid");
                            $("#pageContent1").addClass("hid");
                        } else {
                            handleData(data);
                            $(".noDate1").addClass("hid");
                            $("#pageContent1").removeClass("hid");
                        }
                        page();
                    }
                });
            }

            function handleData(data) {
                $('#talkR1').empty();
                var ckType = "";
                var checkType = "";
                var stats = "";
                var lookStatus = "";
                for (var i = 0; i < data.length; i++) {
                    if (data[i].checkType == 1) {
                        checkType = "党员"
                    }
                    if (data[i].checkType == 2) {
                        checkType = "干部"
                    }
                    if (data[i].stats == 1) {
                        stats = "考核中";
                        lookStatus = "考评";
                    }
                    if (data[i].stats == 2) {
                        stats = "考核完毕";
                        lookStatus = "查看";
                    }
                    if (data[i].ckType == 0) {
                        var oTr = '<tr>\n' +
                            '                        <td>' + (i + 1) + '</td>\n' +
                            '                        <td><a style="color: #2196f3;" href="lookRegular.html?id=' + data[i]._id + '&&me=党员">' + data[i].title + '</a></td>\n' +
                            '                        <td>' + data[i].bumenName + '</td>\n' +
                            '                        <td><input type="hidden" class="checkType" value=' + data[i].checkType + '><input type="hidden" class="bumenId" value=' + data[i].bumenId + '><input type="hidden" class="id" value=' + data[i]._id + '><span class="lookOne">查看</span></td>\n' +
                            '                        <td>' + checkType + '</td>\n';
                        if (data[i].formtStarCycle != "") {
                            oTr = oTr + '<td>' + data[i].formtStarCycle + '到' + data[i].formtEndCycle + '</td>\n';
                        } else {
                            oTr = oTr + '<td></td>';
                        }
                        oTr = oTr + '                        <td>' + data[i].adSum + '</td>\n' +
                            '                        <td>' + data[i].subSum + '</td>\n' +
                            '                        <td>' + data[i].adedSum + '</td>\n' +
                            '                        <td>' + stats + '</td>\n' +
                            '                        <td><input class="title" type="hidden" value=' + data[i].title + '><input class="id" type="hidden" value=' + data[i]._id + '><span class="look">' + lookStatus + '</span></td>\n' +
                            '                    </tr>';
                    } else {
                        if (data[i].ckType == 1) {
                            ckType = "全体党员";
                        }
                        if (data[i].ckType == 2) {
                            ckType = "处级以上干部";
                        }
                        if (data[i].ckType == 3) {
                            ckType = "党支部书记";
                        }
                        if (data[i].ckType == 4) {
                            ckType = "党总支书记";
                        }
                        if (data[i].ckType == 5) {
                            ckType = "党委书记";
                        }
                        var oTr = '<tr>\n' +
                            '                        <td>' + (i + 1) + '</td>\n' +
                            '                        <td><a style="color: #2196f3;" href="lookRegular.html?id=' + data[i]._id + '&&me=党员">' + data[i].title + '</a></td>\n' +
                            '                        <td>' + data[i].bumenName + '</td>\n' +
                            '                        <td>' + ckType + '</td>\n' +
                            '                        <td>' + checkType + '</td>\n';
                        if (data[i].formtStarCycle != "") {
                            oTr = oTr + '<td>' + data[i].formtStarCycle + '到' + data[i].formtEndCycle + '</td>\n';
                        } else {
                            oTr = oTr + '<td></td>';
                        }
                        oTr = oTr +
                            '                        <td>' + data[i].adSum + '</td>\n' +
                            '                        <td>' + data[i].subSum + '</td>\n' +
                            '                        <td>' + data[i].adedSum + '</td>\n' +
                            '                        <td>' + stats + '</td>\n' +
                            '                        <td><input class="title" type="hidden" value=' + data[i].title + '><input class="id" type="hidden" value=' + data[i]._id + '><span class="look">' + lookStatus + '</span></td>\n' +
                            '                    </tr>';
                    }

                    $('#talkR1').append(oTr);
                }
            }

            $('#talkR1').on("click", function(e) {
                var target = e.target;
                var checkType = $(target).parent().find(".checkType").val();
                var bumenId = $(target).parent().find(".bumenId").val();
                var currId = $(target).parent().find(".id").val();
                var title = $(target).parent().find(".title").val();
                if ($(target).text() == "考评") {
                    window.location.href = "pingFLook.html?id=" + currId + "&&me=党员&&title=" + title;
                }
                if ($(target).text() == "查看" && $(target).attr("class") == "look") {
                    window.location.href = "pingFLook.html?id=" + currId + "&&me=党员&&title=" + title;
                }
                if ($(target).text() == "查看" && $(target).attr("class") == "lookOne") {
                    $("#poper1").removeClass("hid");
                    $(".mask").removeClass("hid");
                    var zNodes = [];
                    //tree
                    var setting = {
                        view: {
                            dblClickExpand: false
                        },
                        data: {
                            simpleData: {
                                enable: true,
                                idKey: "id",
                                pIdKey: "pId"
                            },
                            key: {
                                name: "name"
                            }
                        },
                        check: {
                            enable: true,
                            chkDisabledInherit: true,
                            chkStyle: "checkbox",
                            chkboxType: {
                                "Y": "",
                                "N": ""
                            }
                        },
                        callback: {}
                    };
                    buildTree();

                    function buildTree() {
                        $.ajax({
                            type: "POST",
                            url: path + "partyCheck/findCheckBUsers.action",
                            data: {
                                "checkId": currId,
                                "bumenId": bumenId,
                                "checkType": checkType
                            },
                            dataType: "json",
                            success: function(data) {
                                var data = data.data;
                                if (data) {
                                    zNodes = data;
                                    var zTree = $.fn.zTree.init($("#treeDemo1"), setting, zNodes);
                                    var node = zTree.getNodeByParam("id", 0);
                                    //alert(JSON.stringify(node));
                                    zTree.selectNode(node);
                                    zTree.expandNode(node, true, false, false);
                                    var treeObj = $.fn.zTree.getZTreeObj("treeDemo1");
                                    treeObj.expandAll(true);
                                }
                                hibb_Nodes();

                            }
                        });
                    }


                    $("#cancel").click(function() {
                        $("#poper1").addClass("hid");
                        $(".mask").addClass("hid");
                    });
                    $("#close").click(function() {
                        $("#poper1").addClass("hid");
                        $(".mask").addClass("hid");
                    });
                    $(".mask").click(function() {
                        $("#poper1").addClass("hid");
                        $(".mask").addClass("hid");
                    });
                    $("#sure").click(function() {
                        $("#poper1").addClass("hid");
                        $(".mask").addClass("hid");

                    });

                    function hibb_Nodes() {
                        var treeObj = $.fn.zTree.getZTreeObj("treeDemo1");
                        var nodes = treeObj.transformToArray(treeObj.getNodes());
                        for (var node in nodes) {
                            treeObj.setChkDisabled(nodes[node], true);
                        }
                    }
                }
            })
        }
    })
</script>

</html>