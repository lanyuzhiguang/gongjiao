(function($){var settings={},roots={},caches={},zId=0,_consts={event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}r.children=[];r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[]},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED);o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.unbind(c.CLICK);o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.unbind(c.EXPAND);o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.unbind(c.COLLAPSE);o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.unbind(c.ASYNC_SUCCESS);o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.unbind(c.ASYNC_ERROR);o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])})},_eventProxy=function(event){var target=event.target,setting=settings[event.data.treeId],tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=target.parentNode.id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tmp.parentNode.id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":if(!node.isParent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return }var childKey=setting.data.key.children;n.level=level;n.tId=setting.treeId+"_"+(++zId);n.parentTId=parentNode?parentNode.tId:null;if(n[childKey]&&n[childKey].length>0){if(typeof n.open=="string"){n.open=tools.eqs(n.open,"true")}n.open=!!n.open;n.isParent=true;n.zAsync=true}else{n.open=false;if(typeof n.isParent=="string"){n.isParent=tools.eqs(n.isParent,"true")}n.isParent=!!n.isParent;n.zAsync=!n.isParent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[node.tId]=node},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy){_init.proxys.push(initProxy)},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,nodes){var childKey=setting.data.key.children;if(!parentNode[childKey]){parentNode[childKey]=[]}if(parentNode[childKey].length>0){parentNode[childKey][parentNode[childKey].length-1].isLastNode=false;view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])}parentNode.isParent=true;parentNode[childKey]=parentNode[childKey].concat(nodes)},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNextNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);if(node.isLastNode){return null}else{if(node.isFirstNode){return p[childKey][1]}else{for(var i=1,l=p[childKey].length-1;i<l;i++){if(p[childKey][i]===node){return p[childKey][i+1]}}}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}var childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){return nodes[i]}var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[tId];return n?n:null},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){result.push(nodes[i])}result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(typeof nodes[i][key]=="string"&&nodes[i][key].indexOf(value)>-1){result.push(nodes[i])}result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle){if(!nodes){return(isSingle?null:[])}var childKey=setting.data.key.children,result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i]],false)){if(isSingle){return nodes[i]}result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);if(node.isFirstNode){return null}else{if(node.isLastNode){return p[childKey][p[childKey].length-2]}else{for(var i=1,l=p[childKey].length-1;i<l;i++){if(p[childKey][i]===node){return p[childKey][i-1]}}}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getTitleKey:function(setting){return setting.data.key.title===""?setting.data.key.name:setting.data.key.title},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){arguments.callee(setting,node[childKey][i])}}delete data.getCache(setting).nodes[node.tId]},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){r.push(nodes[i]);if(nodes[i][childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey]))}}}else{r.push(nodes);if(nodes[childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[childKey]))}}return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap=[];for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){if(tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]){if(!tmpMap[sNodes[i][parentKey]][childKey]){tmpMap[sNodes[i][parentKey]][childKey]=[]}tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;o.unbind("click",event.proxy);o.bind("click",eventParam,event.proxy);o.unbind("dblclick",event.proxy);o.bind("dblclick",eventParam,event.proxy);o.unbind("mouseover",event.proxy);o.bind("mouseover",eventParam,event.proxy);o.unbind("mouseout",event.proxy);o.bind("mouseout",eventParam,event.proxy);o.unbind("mousedown",event.proxy);o.bind("mousedown",eventParam,event.proxy);o.unbind("mouseup",event.proxy);o.bind("mouseup",eventParam,event.proxy);o.unbind("contextmenu",event.proxy);o.bind("contextmenu",eventParam,event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}try{if(x&&$("input:focus").length==0){tools.noSel(setting)}}catch(e){}return r}},handler={onSwitchNode:function(event,node){var setting=settings[event.data.treeId];if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=settings[event.data.treeId],clickFlag=((setting.view.autoCancelSelected)&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true},onZTreeMousedown:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node])}return true},onZTreeMouseup:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node])}return true},onZTreeContextmenu:function(event,node){var setting=settings[event.data.treeId];if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node])}return(typeof setting.callback.onRightClick)!="function"}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return(setting.async.enable&&node&&node.isParent&&!(node.zAsync||(node[childKey]&&node[childKey].length>0)))},clone:function(jsonObj){var buf;if(jsonObj instanceof Array){buf=[];var i=jsonObj.length;while(i--){buf[i]=arguments.callee(jsonObj[i])}return buf}else{if(typeof jsonObj=="function"){return jsonObj}else{if(jsonObj instanceof Object){buf={};for(var k in jsonObj){buf[k]=arguments.callee(jsonObj[k])}return buf}else{return jsonObj}}}},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},noSel:function(setting){var r=data.getRoot(setting);if(r.noSelection){try{window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}catch(e){}}},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,newNodes,isSilent){if(setting.data.keep.leaf&&parentNode&&!parentNode.isParent){return }if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$("#"+parentNode.tId+consts.id.SWITCH),target_icoObj=$("#"+parentNode.tId+consts.id.ICON),target_ulObj=$("#"+parentNode.tId+consts.id.UL);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({display:"none"})}data.addNodesData(setting,parentNode,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),newNodes);view.createNodes(setting,0,newNodes,null)}},appendNodes:function(setting,level,nodes,parentNode,initFlag,openFlag){if(!nodes){return[]}var html=[],childKey=setting.data.key.children,nameKey=setting.data.key.name,titleKey=data.getTitleKey(setting);for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i],tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=tmpPNode[childKey],isFirstNode=((tmpPChild.length==nodes.length)&&(i==0)),isLastNode=(i==(nodes.length-1));if(initFlag){data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var childHtml=[];if(node[childKey]&&node[childKey].length>0){childHtml=view.appendNodes(setting,level+1,node[childKey],node,initFlag,openFlag&&node.open)}if(openFlag){var url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<li id='",node.tId,"' class='level",node.level,"' tabindex='0' hidefocus='true' treenode>","<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>");data.getBeforeA(setting,node,html);html.push("<a id='",node.tId,consts.id.A,"' class='level",node.level,"' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&node[titleKey]){html.push("title='",node[titleKey].replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">");data.getInnerBeforeA(setting,node,html);var name=setting.view.nameIsHTML?node[nameKey]:node[nameKey].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"'>",name,"</span>");data.getInnerAfterA(setting,node,html);html.push("</a>");data.getAfterA(setting,node,html);if(node.isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}html.push("</li>");data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$("#"+node.tId),ulObj=$("#"+node.tId+consts.id.UL),childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$("#"+node.tId)}if(ulObj.get(0)){ulObj.remove()}nObj.append(html.join(""));view.createNodeCallback(setting)},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$("#"+node.tId+consts.id.ICON);icoObj.attr({style:"","class":"button ico_loading"})}var isJson=(setting.async.contentType=="application/json"),tmpParam=isJson?"{":"",jTemp="";for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}if(isJson){jTemp=(typeof node[pKey]=="string")?'"':"";tmpParam+='"'+spKey+('":'+jTemp+node[pKey]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=spKey+("="+node[pKey]).replace(/&/g,"%26")+"&"}}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){if(isJson){jTemp=(typeof setting.async.otherParam[i+1]=="string")?'"':"";tmpParam+='"'+setting.async.otherParam[i]+('":'+jTemp+setting.async.otherParam[i+1]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=setting.async.otherParam[i]+("="+setting.async.otherParam[i+1]).replace(/&/g,"%26")+"&"}}}else{for(var p in setting.async.otherParam){if(isJson){jTemp=(typeof setting.async.otherParam[p]=="string")?'"':"";tmpParam+='"'+p+('":'+jTemp+setting.async.otherParam[p]).replace(/'/g,"\\'")+jTemp+","}else{tmpParam+=p+("="+setting.async.otherParam[p]).replace(/&/g,"%26")+"&"}}}if(tmpParam.length>1){tmpParam=tmpParam.substring(0,tmpParam.length-1)}if(isJson){tmpParam+="}"}$.ajax({contentType:setting.async.contentType,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!=""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node){var list=data.getRoot(setting).curSelectedList;for(var i=0,j=list.length-1;j>=i;j--){if(!node||node===list[j]){$("#"+list[j].tId+consts.id.A).removeClass(consts.node.CURSELECTED);view.setNodeName(setting,list[j]);if(node){data.removeSelectedNode(setting,node);break}}}if(!node){data.getRoot(setting).curSelectedList=[]}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode){if(!nodes||nodes.length==0){return }var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$("#"+parentNode[childKey][0].tId).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,true,openFlag);if(!parentNode){setting.treeObj.append(zTreeHtml.join(""))}else{var ulObj=$("#"+parentNode.tId+consts.id.UL);if(ulObj.get(0)){ulObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children;if(!node){tools.apply(callback,[]);return }if(root.expandTriggerFlag){var _callback=callback;callback=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};root.expandTriggerFlag=false}if(node.open==expandFlag){tools.apply(callback,[]);return }if(!node.open&&node.isParent&&((!$("#"+node.tId+consts.id.UL).get(0))||(node[childKey]&&node[childKey].length>0&&!$("#"+node[childKey][0].tId).get(0)))){view.appendParentULDom(setting,node)}var ulObj=$("#"+node.tId+consts.id.UL),switchObj=$("#"+node.tId+consts.id.SWITCH),icoObj=$("#"+node.tId+consts.id.ICON);if(node.isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(node[childKey]&&node[childKey].length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(node[childKey]&&node[childKey].length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return }if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return }else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=(node)?node[childKey]:root[childKey],selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(node.isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return"button "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=(node.isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node.icon;if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(node.isParent){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return"button level"+node.level+" switch "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='level",node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return }var childKey=setting.data.key.children,nodes=node[childKey];if(!nodes){return }for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[childKey];if(!setting.data.keep.parent){node.isParent=false;node.open=false;var tmp_switchObj=$("#"+node.tId+consts.id.SWITCH),tmp_icoObj=$("#"+node.tId+consts.id.ICON);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$("#"+node.tId+consts.id.UL).remove()}else{$("#"+node.tId+consts.id.UL).empty()}},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};$("#"+node.tId).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}}var tmp_ulObj,tmp_switchObj,tmp_icoObj;if(!setting.data.keep.parent&&parentNode[childKey].length<1){parentNode.isParent=false;parentNode.open=false;tmp_ulObj=$("#"+parentNode.tId+consts.id.UL);tmp_switchObj=$("#"+parentNode.tId+consts.id.SWITCH);tmp_icoObj=$("#"+parentNode.tId+consts.id.ICON);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&parentNode[childKey].length>0){var newLast=parentNode[childKey][parentNode[childKey].length-1];newLast.isLastNode=true;newLast.isFirstNode=(parentNode[childKey].length==1);tmp_ulObj=$("#"+newLast.tId+consts.id.UL);tmp_switchObj=$("#"+newLast.tId+consts.id.SWITCH);tmp_icoObj=$("#"+newLast.tId+consts.id.ICON);if(parentNode==root){if(parentNode[childKey].length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$("#"+parentNode[childKey][0].tId+consts.id.SWITCH);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return }var tmpName=obj.attr("class");if(tmpName==undefined){return }var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return }var tmpName=obj.attr("class");if(tmpName==undefined){return }var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting)}$("#"+node.tId+consts.id.A).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node)},setNodeFontCss:function(setting,treeNode){var aObj=$("#"+treeNode.tId+consts.id.A),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeLineIcos:function(setting,node){if(!node){return }var switchObj=$("#"+node.tId+consts.id.SWITCH),ulObj=$("#"+node.tId+consts.id.UL),icoObj=$("#"+node.tId+consts.id.ICON),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(node.isParent){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var nameKey=setting.data.key.name,titleKey=data.getTitleKey(setting),nObj=$("#"+node.tId+consts.id.SPAN);nObj.empty();if(setting.view.nameIsHTML){nObj.html(node[nameKey])}else{nObj.text(node[nameKey])}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&node[titleKey]){var aObj=$("#"+node.tId+consts.id.A);aObj.attr("title",node[titleKey])}},setNodeTarget:function(node){var aObj=$("#"+node.tId+consts.id.A);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$("#"+node.tId+consts.id.A),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return }}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){root[childKey]=data.transformTozTreeFormat(setting,zNodes)}else{root[childKey]=zNodes}data.initCache(setting);event.bindTree(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,newNodes,isSilent){if(!newNodes){return null}if(!parentNode){parentNode=null}if(parentNode&&!parentNode.isParent&&setting.data.keep.leaf){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(this.setting,node)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(this.setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!node.isParent){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(this.setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(sonSign){view.expandCollapseSonNode(this.setting,node,expandFlag,true,function(){if(focus!==false){$("#"+node.tId).focus().blur()}})}else{node.open=!expandFlag;view.switchNode(this.setting,node);if(focus!==false){$("#"+node.tId).focus().blur()}}return expandFlag},getNodes:function(){return data.getNodes(this.setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(this.setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(this.setting,parentNode?parentNode[this.setting.data.key.children]:data.getNodes(this.setting),filter,isSingle)},getNodeIndex:function(node){if(!node){return null}var childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():data.getRoot(this.setting);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(this.setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(this.setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(!this.setting.async.enable){return }var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(this.setting)}if(reloadType=="refresh"){parentNode[this.setting.data.key.children]=[];if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$("#"+parentNode.tId+consts.id.UL);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(this.setting),nodes=root[this.setting.data.key.children];data.initRoot(this.setting);root[this.setting.data.key.children]=nodes;data.initCache(this.setting);view.createNodes(this.setting,0,root[this.setting.data.key.children])},removeChildNodes:function(node){if(!node){return null}var childKey=setting.data.key.children,nodes=node[childKey];view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return }callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return }view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag){if(!node){return }if(tools.uCanDo(this.setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(this.setting,node.getParentNode(),true,false,function(){$("#"+node.tId).focus().blur()})}else{$("#"+node.tId).focus().blur()}view.selectNode(this.setting,node,addFlag)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(this.setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(this.setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return }var nObj=$("#"+node.tId);if(nObj.get(0)&&tools.uCanDo(this.setting)){view.setNodeName(this.setting,node);view.setNodeTarget(node);view.setNodeUrl(this.setting,node);view.setNodeLineIcos(this.setting,node);view.setNodeFontCss(this.setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);if(root[childKey]&&root[childKey].length>0){view.createNodes(setting,0,root[childKey])}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,consts=zt.consts})(jQuery);(function(F){var X={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},L={check:{enable:false,autoCheckTrigger:false,chkStyle:X.checkbox.STYLE,nocheckInherit:false,radioType:X.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},U=function(Y){var Z=W.getRoot(Y);Z.radioCheckedList=[]},D=function(Y){},M=function(Y){var Z=Y.treeObj,a=P.event;Z.unbind(a.CHECK);Z.bind(a.CHECK,function(c,d,b){S.apply(Y.callback.onCheck,[c,d,b])})},N=function(f){var g=f.target,i=W.getSetting(f.data.treeId),c="",Z=null,a="",d="",Y=null,b=null;if(S.eqs(f.type,"mouseover")){if(i.check.enable&&S.eqs(g.tagName,"span")&&g.getAttribute("treeNode"+P.id.CHECK)!==null){c=g.parentNode.id;a="mouseoverCheck"}}else{if(S.eqs(f.type,"mouseout")){if(i.check.enable&&S.eqs(g.tagName,"span")&&g.getAttribute("treeNode"+P.id.CHECK)!==null){c=g.parentNode.id;a="mouseoutCheck"}}else{if(S.eqs(f.type,"click")){if(i.check.enable&&S.eqs(g.tagName,"span")&&g.getAttribute("treeNode"+P.id.CHECK)!==null){c=g.parentNode.id;a="checkNode"}}}}if(c.length>0){Z=W.getNodeCache(i,c);switch(a){case"checkNode":Y=K.onCheckNode;break;case"mouseoverCheck":Y=K.onMouseoverCheck;break;case"mouseoutCheck":Y=K.onMouseoutCheck;break}}var h={stop:false,node:Z,nodeEventType:a,nodeEventCallback:Y,treeEventType:d,treeEventCallback:b};return h},T=function(b,f,e,Y,d,a,c){if(!e){return }var Z=b.data.key.checked;if(typeof e[Z]=="string"){e[Z]=S.eqs(e[Z],"true")}e[Z]=!!e[Z];e.checkedOld=e[Z];e.nocheck=!!e.nocheck||(b.check.nocheckInherit&&Y&&!!Y.nocheck);e.chkDisabled=!!e.chkDisabled||(Y&&!!Y.chkDisabled);if(typeof e.halfCheck=="string"){e.halfCheck=S.eqs(e.halfCheck,"true")}e.halfCheck=!!e.halfCheck;e.check_Child_State=-1;e.check_Focus=false;e.getCheckStatus=function(){return W.getCheckStatus(b,e)};if(a){W.makeChkFlag(b,Y)}},A=function(a,c,Z){var Y=a.data.key.checked;if(a.check.enable){W.makeChkFlag(a,c);if(a.check.chkStyle==P.radio.STYLE&&a.check.radioType==P.radio.TYPE_ALL&&c[Y]){var b=W.getRoot(a);b.radioCheckedList.push(c)}Z.push("<span ID='",c.tId,P.id.CHECK,"' class='",I.makeChkClass(a,c),"' treeNode",P.id.CHECK,(c.nocheck===true?" style='display:none;'":""),"></span>")}},J=function(a,Z){Z.checkNode=function(f,e,g,d){var b=this.setting.data.key.checked;if(f.chkDisabled===true){return }if(e!==true&&e!==false){e=!f[b]}d=!!d;if(f[b]===e&&!g){return }else{if(d&&S.apply(this.setting.callback.beforeCheck,[this.setting.treeId,f],true)==false){return }}if(S.uCanDo(this.setting)&&this.setting.check.enable&&f.nocheck!==true){f[b]=e;var c=F("#"+f.tId+P.id.CHECK);if(g||this.setting.check.chkStyle===P.radio.STYLE){I.checkNodeRelation(this.setting,f)}I.setChkClass(this.setting,c,f);I.repairParentChkClassWithSelf(this.setting,f);if(d){a.treeObj.trigger(P.event.CHECK,[a.treeId,f])}}};Z.checkAllNodes=function(b){I.repairAllChk(this.setting,!!b)};Z.getCheckedNodes=function(c){var b=this.setting.data.key.children;c=(c!==false);return W.getTreeCheckedNodes(this.setting,W.getRoot(a)[b],c)};Z.getChangeCheckedNodes=function(){var b=this.setting.data.key.children;return W.getTreeChangeCheckedNodes(this.setting,W.getRoot(a)[b])};Z.setChkDisabled=function(c,b){b=!!b;I.repairSonChkDisabled(this.setting,c,b);if(!b){I.repairParentChkDisabled(this.setting,c,b)}};var Y=Z.updateNode;Z.updateNode=function(d,e){if(Y){Y.apply(Z,arguments)}if(!d||!this.setting.check.enable){return }var b=F("#"+d.tId);if(b.get(0)&&S.uCanDo(this.setting)){var c=F("#"+d.tId+P.id.CHECK);if(e==true||this.setting.check.chkStyle===P.radio.STYLE){I.checkNodeRelation(this.setting,d)}I.setChkClass(this.setting,c,d);I.repairParentChkClassWithSelf(this.setting,d)}}},O={getRadioCheckedList:function(b){var a=W.getRoot(b).radioCheckedList;for(var Z=0,Y=a.length;Z<Y;Z++){if(!W.getNodeCache(b,a[Z].tId)){a.splice(Z,1);Z--;Y--}}return a},getCheckStatus:function(Z,b){if(!Z.check.enable||b.nocheck){return null}var Y=Z.data.key.checked,a={checked:b[Y],half:b.halfCheck?b.halfCheck:(Z.check.chkStyle==P.radio.STYLE?(b.check_Child_State===2):(b[Y]?(b.check_Child_State>-1&&b.check_Child_State<2):(b.check_Child_State>0)))};return a},getTreeCheckedNodes:function(d,a,f,c){if(!a){return[]}var e=d.data.key.children,Z=d.data.key.checked;c=!c?[]:c;for(var b=0,Y=a.length;b<Y;b++){if(a[b].nocheck!==true&&a[b][Z]==f){c.push(a[b])}W.getTreeCheckedNodes(d,a[b][e],f,c)}return c},getTreeChangeCheckedNodes:function(d,a,c){if(!a){return[]}var e=d.data.key.children,Z=d.data.key.checked;c=!c?[]:c;for(var b=0,Y=a.length;b<Y;b++){if(a[b].nocheck!==true&&a[b][Z]!=a[b].checkedOld){c.push(a[b])}W.getTreeChangeCheckedNodes(d,a[b][e],c)}return c},makeChkFlag:function(h,b){if(!b){return }var a=h.data.key.children,Y=h.data.key.checked,d=-1;if(b[a]){var Z=false;for(var f=0,c=b[a].length;f<c;f++){var g=b[a][f];var e=-1;if(h.check.chkStyle==P.radio.STYLE){if(g.nocheck===true){e=g.check_Child_State}else{if(g.halfCheck===true){e=2}else{if(g.nocheck!==true&&g[Y]){e=2}else{e=g.check_Child_State>0?2:0}}}if(e==2){d=2;break}else{if(e==0){d=0}}}else{if(h.check.chkStyle==P.checkbox.STYLE){if(g.nocheck===true){e=g.check_Child_State}else{if(g.halfCheck===true){e=1}else{if(g.nocheck!==true&&g[Y]){e=(g.check_Child_State===-1||g.check_Child_State===2)?2:1}else{e=(g.check_Child_State>0)?1:0}}}if(e===1){d=1;break}else{if(e===2&&Z&&e!==d){d=1;break}else{if(d===2&&e>-1&&e<2){d=1;break}else{if(e>-1){d=e}}}}if(!Z){Z=(g.nocheck!==true)}}}}}b.check_Child_State=d}},G={},K={onCheckNode:function(c,b){if(b.chkDisabled===true){return false}var a=W.getSetting(c.data.treeId),Y=a.data.key.checked;if(S.apply(a.callback.beforeCheck,[a.treeId,b],true)==false){return true}b[Y]=!b[Y];I.checkNodeRelation(a,b);var Z=F("#"+b.tId+P.id.CHECK);I.setChkClass(a,Z,b);I.repairParentChkClassWithSelf(a,b);a.treeObj.trigger(P.event.CHECK,[a.treeId,b]);return true},onMouseoverCheck:function(b,a){if(a.chkDisabled===true){return false}var Z=W.getSetting(b.data.treeId),Y=F("#"+a.tId+P.id.CHECK);a.check_Focus=true;I.setChkClass(Z,Y,a);return true},onMouseoutCheck:function(b,a){if(a.chkDisabled===true){return false}var Z=W.getSetting(b.data.treeId),Y=F("#"+a.tId+P.id.CHECK);a.check_Focus=false;I.setChkClass(Z,Y,a);return true}},H={},E={checkNodeRelation:function(h,b){var f,d,c,a=h.data.key.children,Z=h.data.key.checked,Y=P.radio;if(h.check.chkStyle==Y.STYLE){var g=W.getRadioCheckedList(h);if(b[Z]){if(h.check.radioType==Y.TYPE_ALL){for(d=g.length-1;d>=0;d--){f=g[d];f[Z]=false;g.splice(d,1);I.setChkClass(h,F("#"+f.tId+P.id.CHECK),f);if(f.parentTId!=b.parentTId){I.repairParentChkClassWithSelf(h,f)}}g.push(b)}else{var e=(b.parentTId)?b.getParentNode():W.getRoot(h);for(d=0,c=e[a].length;d<c;d++){f=e[a][d];if(f[Z]&&f!=b){f[Z]=false;I.setChkClass(h,F("#"+f.tId+P.id.CHECK),f)}}}}else{if(h.check.radioType==Y.TYPE_ALL){for(d=0,c=g.length;d<c;d++){if(b==g[d]){g.splice(d,1);break}}}}}else{if(b[Z]&&(!b[a]||b[a].length==0||h.check.chkboxType.Y.indexOf("s")>-1)){I.setSonNodeCheckBox(h,b,true)}if(!b[Z]&&(!b[a]||b[a].length==0||h.check.chkboxType.N.indexOf("s")>-1)){I.setSonNodeCheckBox(h,b,false)}if(b[Z]&&h.check.chkboxType.Y.indexOf("p")>-1){I.setParentNodeCheckBox(h,b,true)}if(!b[Z]&&h.check.chkboxType.N.indexOf("p")>-1){I.setParentNodeCheckBox(h,b,false)}}},makeChkClass:function(Z,d){var Y=Z.data.key.checked,f=P.checkbox,b=P.radio,e="";if(d.chkDisabled===true){e=f.DISABLED}else{if(d.halfCheck){e=f.PART}else{if(Z.check.chkStyle==b.STYLE){e=(d.check_Child_State<1)?f.FULL:f.PART}else{e=d[Y]?((d.check_Child_State===2||d.check_Child_State===-1)?f.FULL:f.PART):((d.check_Child_State<1)?f.FULL:f.PART)}}}var a=Z.check.chkStyle+"_"+(d[Y]?f.TRUE:f.FALSE)+"_"+e;a=(d.check_Focus&&d.chkDisabled!==true)?a+"_"+f.FOCUS:a;return"button "+f.DEFAULT+" "+a},repairAllChk:function(c,f){if(c.check.enable&&c.check.chkStyle===P.checkbox.STYLE){var a=c.data.key.checked,e=c.data.key.children,Z=W.getRoot(c);for(var b=0,Y=Z[e].length;b<Y;b++){var d=Z[e][b];if(d.nocheck!==true){d[a]=f}I.setSonNodeCheckBox(c,d,f)}}},repairChkClass:function(Z,a){if(!a){return }W.makeChkFlag(Z,a);var Y=F("#"+a.tId+P.id.CHECK);I.setChkClass(Z,Y,a)},repairParentChkClass:function(Z,a){if(!a||!a.parentTId){return }var Y=a.getParentNode();I.repairChkClass(Z,Y);I.repairParentChkClass(Z,Y)},repairParentChkClassWithSelf:function(Y,a){if(!a){return }var Z=Y.data.key.children;if(a[Z]&&a[Z].length>0){I.repairParentChkClass(Y,a[Z][0])}else{I.repairParentChkClass(Y,a)}},repairSonChkDisabled:function(c,e,b){if(!e){return }var d=c.data.key.children;if(e.chkDisabled!=b){e.chkDisabled=b;if(e.nocheck!==true){I.repairChkClass(c,e)}}if(e[d]){for(var a=0,Z=e[d].length;a<Z;a++){var Y=e[d][a];I.repairSonChkDisabled(c,Y,b)}}},repairParentChkDisabled:function(Z,a,Y){if(!a){return }if(a.chkDisabled!=Y){a.chkDisabled=Y;if(a.nocheck!==true){I.repairChkClass(Z,a)}}I.repairParentChkDisabled(Z,a.getParentNode(),Y)},setChkClass:function(Y,a,Z){if(!a){return }if(Z.nocheck===true){a.hide()}else{a.show()}a.removeClass();a.addClass(I.makeChkClass(Y,Z))},setParentNodeCheckBox:function(j,b,h,e){var a=j.data.key.children,Y=j.data.key.checked,f=F("#"+b.tId+P.id.CHECK);if(!e){e=b}W.makeChkFlag(j,b);if(b.nocheck!==true&&b.chkDisabled!==true){b[Y]=h;I.setChkClass(j,f,b);if(j.check.autoCheckTrigger&&b!=e&&b.nocheck!==true){j.treeObj.trigger(P.event.CHECK,[j.treeId,b])}}if(b.parentTId){var g=true;if(!h){var Z=b.getParentNode()[a];for(var d=0,c=Z.length;d<c;d++){if((Z[d].nocheck!==true&&Z[d][Y])||(Z[d].nocheck===true&&Z[d].check_Child_State>0)){g=false;break}}}if(g){I.setParentNodeCheckBox(j,b.getParentNode(),h,e)}}},setSonNodeCheckBox:function(j,b,h,e){if(!b){return }var a=j.data.key.children,Y=j.data.key.checked,f=F("#"+b.tId+P.id.CHECK);if(!e){e=b}var Z=false;if(b[a]){for(var d=0,c=b[a].length;d<c&&b.chkDisabled!==true;d++){var g=b[a][d];I.setSonNodeCheckBox(j,g,h,e);if(g.chkDisabled===true){Z=true}}}if(b!=W.getRoot(j)&&b.chkDisabled!==true){if(Z&&b.nocheck!==true){W.makeChkFlag(j,b)}if(b.nocheck!==true){b[Y]=h;if(!Z){b.check_Child_State=(b[a]&&b[a].length>0)?(h?2:0):-1}}else{b.check_Child_State=-1}I.setChkClass(j,f,b);if(j.check.autoCheckTrigger&&b!=e&&b.nocheck!==true){j.treeObj.trigger(P.event.CHECK,[j.treeId,b])}}}},R={tools:H,view:E,event:G,data:O};F.extend(true,F.fn.zTree.consts,X);F.extend(true,F.fn.zTree._z,R);var C=F.fn.zTree,S=C._z.tools,P=C.consts,I=C._z.view,W=C._z.data,Q=C._z.event;W.exSetting(L);W.addInitBind(M);W.addInitCache(D);W.addInitNode(T);W.addInitProxy(N);W.addInitRoot(U);W.addBeforeA(A);W.addZTreeTools(J);var V=I.createNodes;I.createNodes=function(a,b,Z,Y){if(V){V.apply(I,arguments)}if(!Z){return }I.repairParentChkClassWithSelf(a,Y)};var B=I.removeNode;I.removeNode=function(Z,a){var Y=a.getParentNode();if(B){B.apply(I,arguments)}if(!a||!Y){return }I.repairChkClass(Z,Y);I.repairParentChkClass(Z,Y)}})(jQuery);(function(F){var Z={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},L={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}},V=function(a){var b=X.getRoot(a);b.curEditNode=null;b.curEditInput=null;b.curHoverNode=null;b.dragFlag=0;b.dragNodeShowBefore=[];b.dragMaskList=new Array();b.showHoverDom=true},C=function(a){},M=function(a){var b=a.treeObj;var d=P.event;b.unbind(d.RENAME);b.bind(d.RENAME,function(c,f,e){T.apply(a.callback.onRename,[c,f,e])});b.unbind(d.REMOVE);b.bind(d.REMOVE,function(c,f,e){T.apply(a.callback.onRemove,[c,f,e])});b.unbind(d.DRAG);b.bind(d.DRAG,function(e,c,g,f){T.apply(a.callback.onDrag,[c,g,f])});b.unbind(d.DROP);b.bind(d.DROP,function(g,f,i,h,j,e,c){T.apply(a.callback.onDrop,[f,i,h,j,e,c])})},N=function(i){var j=i.target,m=X.getSetting(i.data.treeId),k=i.relatedTarget,g="",b=null,c="",h="",a=null,f=null,d=null;if(T.eqs(i.type,"mouseover")){d=T.getMDom(m,j,[{tagName:"a",attrName:"treeNode"+P.id.A}]);if(d){g=d.parentNode.id;c="hoverOverNode"}}else{if(T.eqs(i.type,"mouseout")){d=T.getMDom(m,k,[{tagName:"a",attrName:"treeNode"+P.id.A}]);if(!d){g="remove";c="hoverOutNode"}}else{if(T.eqs(i.type,"mousedown")){d=T.getMDom(m,j,[{tagName:"a",attrName:"treeNode"+P.id.A}]);if(d){g=d.parentNode.id;c="mousedownNode"}}}}if(g.length>0){b=X.getNodeCache(m,g);switch(c){case"mousedownNode":a=K.onMousedownNode;break;case"hoverOverNode":a=K.onHoverOverNode;break;case"hoverOutNode":a=K.onHoverOutNode;break}}var l={stop:false,node:b,nodeEventType:c,nodeEventCallback:a,treeEventType:h,treeEventCallback:f};return l},U=function(c,g,f,a,e,b,d){if(!f){return }f.isHover=false;f.editNameFlag=false},J=function(b,a){a.cancelEditName=function(d){var c=X.getRoot(b),e=b.data.key.name,f=c.curEditNode;if(!c.curEditNode){return }I.cancelCurEditNode(b,d?d:f[e])};a.copyNode=function(g,f,e,h){if(!f){return null}if(g&&!g.isParent&&b.data.keep.leaf&&e===P.move.TYPE_INNER){return null}var c=T.clone(f);if(!g){g=null;e=P.move.TYPE_INNER}if(e==P.move.TYPE_INNER){function d(){I.addNodes(b,g,[c],h)}if(T.canAsync(b,g)){I.asyncNode(b,g,h,d)}else{d()}}else{I.addNodes(b,g.parentNode,[c],h);I.moveNode(b,g,c,e,false,h)}return c};a.editName=function(c){if(!c||!c.tId||c!==X.getNodeCache(b,c.tId)){return }if(c.parentTId){I.expandCollapseParentNode(b,c.getParentNode(),true)}I.editNode(b,c)};a.moveNode=function(e,d,c,g){if(!d){return d}if(e&&!e.isParent&&b.data.keep.leaf&&c===P.move.TYPE_INNER){return null}else{if(e&&((d.parentTId==e.tId&&c==P.move.TYPE_INNER)||F("#"+d.tId).find("#"+e.tId).length>0)){return null}else{if(!e){e=null}}}function f(){I.moveNode(b,e,d,c,false,g)}if(T.canAsync(b,e)){I.asyncNode(b,e,g,f)}else{f()}return d};a.setEditable=function(c){b.edit.enable=c;return this.refresh()}},O={setSonNodeLevel:function(d,a,f){if(!f){return }var e=d.data.key.children;f.level=(a)?a.level+1:0;if(!f[e]){return }for(var c=0,b=f[e].length;c<b;c++){if(f[e][c]){X.setSonNodeLevel(d,f,f[e][c])}}}},G={},K={onHoverOverNode:function(d,c){var b=X.getSetting(d.data.treeId),a=X.getRoot(b);if(a.curHoverNode!=c){K.onHoverOutNode(d)}a.curHoverNode=c;I.addHoverDom(b,c)},onHoverOutNode:function(d,c){var b=X.getSetting(d.data.treeId),a=X.getRoot(b);if(a.curHoverNode&&!X.isSelectedNode(b,a.curHoverNode)){I.removeTreeDom(b,a.curHoverNode);a.curHoverNode=null}},onMousedownNode:function(o,g){var w,t,n=X.getSetting(o.data.treeId),s=X.getRoot(n);if(o.button==2||!n.edit.enable||(!n.edit.drag.isCopy&&!n.edit.drag.isMove)){return true}var z=o.target,f=X.getRoot(n).curSelectedList,p=[];if(!X.isSelectedNode(n,g)){p=[g]}else{for(w=0,t=f.length;w<t;w++){if(f[w].editNameFlag&&T.eqs(z.tagName,"input")&&z.getAttribute("treeNode"+P.id.INPUT)!==null){return true}p.push(f[w]);if(p[0].parentTId!==f[w].parentTId){p=[g];break}}}I.editNodeBlur=true;I.cancelCurEditNode(n,null,true);var AC=F(document),v,h,x,y=false,AA=n,a,e,q=null,d=null,m=null,b=P.move.TYPE_INNER,u=o.clientX,r=o.clientY,j=(new Date()).getTime();if(T.uCanDo(n)){AC.bind("mousemove",k)}function k(A0){if(s.dragFlag==0&&Math.abs(u-A0.clientX)<n.edit.drag.minMoveSize&&Math.abs(r-A0.clientY)<n.edit.drag.minMoveSize){return true}var Av,Ar,AT,Am,Ae,Al=n.data.key.children;T.noSel(n);F("body").css("cursor","pointer");if(s.dragFlag==0){if(T.apply(n.callback.beforeDrag,[n.treeId,p],true)==false){AB(A0);return true}for(Av=0,Ar=p.length;Av<Ar;Av++){if(Av==0){s.dragNodeShowBefore=[]}AT=p[Av];if(AT.isParent&&AT.open){I.expandCollapseNode(n,AT,!AT.open);s.dragNodeShowBefore[AT.tId]=true}else{s.dragNodeShowBefore[AT.tId]=false}}s.dragFlag=1;s.showHoverDom=false;T.showIfameMask(n,true);var AE=true,AH=-1;if(p.length>1){var AR=p[0].parentTId?p[0].getParentNode()[Al]:X.getNodes(n);Ae=[];for(Av=0,Ar=AR.length;Av<Ar;Av++){if(s.dragNodeShowBefore[AR[Av].tId]!==undefined){if(AE&&AH>-1&&(AH+1)!==Av){AE=false}Ae.push(AR[Av]);AH=Av}if(p.length===Ae.length){p=Ae;break}}}if(AE){a=p[0].getPreNode();e=p[p.length-1].getNextNode()}v=F("<ul class='zTreeDragUL'></ul>");for(Av=0,Ar=p.length;Av<Ar;Av++){AT=p[Av];AT.editNameFlag=false;I.selectNode(n,AT,Av>0);I.removeTreeDom(n,AT);Am=F("<li id='"+AT.tId+"_tmp'></li>");Am.append(F("#"+AT.tId+P.id.A).clone());Am.css("padding","0");Am.children("#"+AT.tId+P.id.A).removeClass(P.node.CURSELECTED);v.append(Am);if(Av==n.edit.drag.maxShowNodeNum-1){Am=F("<li id='"+AT.tId+"_moretmp'><a>  ...  </a></li>");v.append(Am);break}}v.attr("id",p[0].tId+P.id.UL+"_tmp");v.addClass(n.treeObj.attr("class"));v.appendTo("body");h=F("<span class='tmpzTreeMove_arrow'></span>");h.attr("id","zTreeMove_arrow_tmp");h.appendTo("body");n.treeObj.trigger(P.event.DRAG,[A0,n.treeId,p])}if(s.dragFlag==1){if(x&&h.attr("id")==A0.target.id&&m&&(A0.clientX+AC.scrollLeft()+2)>(F("#"+m+P.id.A,x).offset().left)){var Az=F("#"+m+P.id.A,x);A0.target=(Az.length>0)?Az.get(0):A0.target}else{if(x){x.removeClass(P.node.TMPTARGET_TREE);if(m){F("#"+m+P.id.A,x).removeClass(P.node.TMPTARGET_NODE+"_"+P.move.TYPE_PREV).removeClass(P.node.TMPTARGET_NODE+"_"+Z.move.TYPE_NEXT).removeClass(P.node.TMPTARGET_NODE+"_"+Z.move.TYPE_INNER)}}}x=null;m=null;y=false;AA=n;var Aw=X.getSettings();for(var An in Aw){if(Aw[An].treeId&&Aw[An].edit.enable&&Aw[An].treeId!=n.treeId&&(A0.target.id==Aw[An].treeId||F(A0.target).parents("#"+Aw[An].treeId).length>0)){y=true;AA=Aw[An]}}var AQ=AC.scrollTop(),Ay=AC.scrollLeft(),AF=AA.treeObj.offset(),AY=AA.treeObj.get(0).scrollHeight,Ao=AA.treeObj.get(0).scrollWidth,Ax=(A0.clientY+AQ-AF.top),Ak=(AA.treeObj.height()+AF.top-A0.clientY-AQ),Af=(A0.clientX+Ay-AF.left),AP=(AA.treeObj.width()+AF.left-A0.clientX-Ay),AS=(Ax<n.edit.drag.borderMax&&Ax>n.edit.drag.borderMin),A1=(Ak<n.edit.drag.borderMax&&Ak>n.edit.drag.borderMin),Ai=(Af<n.edit.drag.borderMax&&Af>n.edit.drag.borderMin),AN=(AP<n.edit.drag.borderMax&&AP>n.edit.drag.borderMin),AG=Ax>n.edit.drag.borderMin&&Ak>n.edit.drag.borderMin&&Af>n.edit.drag.borderMin&&AP>n.edit.drag.borderMin,Ac=(AS&&AA.treeObj.scrollTop()<=0),Ab=(A1&&(AA.treeObj.scrollTop()+AA.treeObj.height()+10)>=AY),AJ=(Ai&&AA.treeObj.scrollLeft()<=0),AW=(AN&&(AA.treeObj.scrollLeft()+AA.treeObj.width()+10)>=Ao);if(A0.target.id&&AA.treeObj.find("#"+A0.target.id).length>0){var AO=A0.target;while(AO&&AO.tagName&&!T.eqs(AO.tagName,"li")&&AO.id!=AA.treeId){AO=AO.parentNode}var AV=true;for(Av=0,Ar=p.length;Av<Ar;Av++){AT=p[Av];if(AO.id===AT.tId){AV=false;break}else{if(F("#"+AT.tId).find("#"+AO.id).length>0){AV=false;break}}}if(AV){if(A0.target.id&&(A0.target.id==(AO.id+P.id.A)||F(A0.target).parents("#"+AO.id+P.id.A).length>0)){x=F(AO);m=AO.id}}}AT=p[0];if(AG&&(A0.target.id==AA.treeId||F(A0.target).parents("#"+AA.treeId).length>0)){if(!x&&(A0.target.id==AA.treeId||Ac||Ab||AJ||AW)&&(y||(!y&&AT.parentTId))){x=AA.treeObj}if(AS){AA.treeObj.scrollTop(AA.treeObj.scrollTop()-10)}else{if(A1){AA.treeObj.scrollTop(AA.treeObj.scrollTop()+10)}}if(Ai){AA.treeObj.scrollLeft(AA.treeObj.scrollLeft()-10)}else{if(AN){AA.treeObj.scrollLeft(AA.treeObj.scrollLeft()+10)}}if(x&&x!=AA.treeObj&&x.offset().left<AA.treeObj.offset().left){AA.treeObj.scrollLeft(AA.treeObj.scrollLeft()+x.offset().left-AA.treeObj.offset().left)}}v.css({top:(A0.clientY+AQ+3)+"px",left:(A0.clientX+Ay+3)+"px"});var Aa=0;var AZ=0;if(x&&x.attr("id")!=AA.treeId){var Aj=m==null?null:X.getNodeCache(AA,m),Ad=(A0.ctrlKey&&n.edit.drag.isMove&&n.edit.drag.isCopy)||(!n.edit.drag.isMove&&n.edit.drag.isCopy),AL=!!(a&&m===a.tId),Ah=!!(e&&m===e.tId),At=(AT.parentTId&&AT.parentTId==m),Ag=(Ad||!Ah)&&T.apply(AA.edit.drag.prev,[AA.treeId,p,Aj],!!AA.edit.drag.prev),AK=(Ad||!AL)&&T.apply(AA.edit.drag.next,[AA.treeId,p,Aj],!!AA.edit.drag.next),AD=(Ad||!At)&&!(AA.data.keep.leaf&&!Aj.isParent)&&T.apply(AA.edit.drag.inner,[AA.treeId,p,Aj],!!AA.edit.drag.inner);if(!Ag&&!AK&&!AD){x=null;m="";b=P.move.TYPE_INNER;h.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}else{var AX=F("#"+m+P.id.A,x),Aq=Aj.isLastNode?null:F("#"+Aj.getNextNode().tId+P.id.A,x.next()),As=AX.offset().top,Au=AX.offset().left,Ap=Ag?(AD?0.25:(AK?0.5:1)):-1,AM=AK?(AD?0.75:(Ag?0.5:0)):-1,AI=(A0.clientY+AQ-As)/AX.height();if((Ap==1||AI<=Ap&&AI>=-0.2)&&Ag){Aa=1-h.width();AZ=As-h.height()/2;b=P.move.TYPE_PREV}else{if((AM==0||AI>=AM&&AI<=1.2)&&AK){Aa=1-h.width();AZ=(Aq==null||(Aj.isParent&&Aj.open))?(As+AX.height()-h.height()/2):(Aq.offset().top-h.height()/2);b=P.move.TYPE_NEXT}else{Aa=5-h.width();AZ=As;b=P.move.TYPE_INNER}}h.css({display:"block",top:AZ+"px",left:(Au+Aa)+"px"});AX.addClass(P.node.TMPTARGET_NODE+"_"+b);if(q!=m||d!=b){j=(new Date()).getTime()}if(Aj&&Aj.isParent&&b==P.move.TYPE_INNER){var AU=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==Aj.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===Aj.tId){AU=false}}if(AU){window.zTreeMoveTimer=setTimeout(function(){if(b!=P.move.TYPE_INNER){return }if(Aj&&Aj.isParent&&!Aj.open&&(new Date()).getTime()-j>AA.edit.drag.autoOpenTime&&T.apply(AA.callback.beforeDragOpen,[AA.treeId,Aj],true)){I.switchNode(AA,Aj);if(AA.edit.drag.autoExpandTrigger){AA.treeObj.trigger(P.event.EXPAND,[AA.treeId,Aj])}}},AA.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=Aj.tId}}}}else{b=P.move.TYPE_INNER;if(x&&T.apply(AA.edit.drag.inner,[AA.treeId,p,null],!!AA.edit.drag.inner)){x.addClass(P.node.TMPTARGET_TREE)}else{x=null}h.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}q=m;d=b}return false}AC.bind("mouseup",AB);function AB(AK){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}q=null;d=null;AC.unbind("mousemove",k);AC.unbind("mouseup",AB);AC.unbind("selectstart",c);F("body").css("cursor","auto");if(x){x.removeClass(P.node.TMPTARGET_TREE);if(m){F("#"+m+P.id.A,x).removeClass(P.node.TMPTARGET_NODE+"_"+P.move.TYPE_PREV).removeClass(P.node.TMPTARGET_NODE+"_"+Z.move.TYPE_NEXT).removeClass(P.node.TMPTARGET_NODE+"_"+Z.move.TYPE_INNER)}}T.showIfameMask(n,false);s.showHoverDom=true;if(s.dragFlag==0){return }s.dragFlag=0;var AI,AE,AJ;for(AI=0,AE=p.length;AI<AE;AI++){AJ=p[AI];if(AJ.isParent&&s.dragNodeShowBefore[AJ.tId]&&!AJ.open){I.expandCollapseNode(n,AJ,!AJ.open);delete s.dragNodeShowBefore[AJ.tId]}}if(v){v.remove()}if(h){h.remove()}var AD=(AK.ctrlKey&&n.edit.drag.isMove&&n.edit.drag.isCopy)||(!n.edit.drag.isMove&&n.edit.drag.isCopy);if(!AD&&x&&m&&p[0].parentTId&&m==p[0].parentTId&&b==P.move.TYPE_INNER){x=null}if(x){var AF=m==null?null:X.getNodeCache(AA,m);if(T.apply(n.callback.beforeDrop,[AA.treeId,p,AF,b,AD],true)==false){return }var AG=AD?T.clone(p):p;function AH(){if(y){if(!AD){for(var AM=0,AL=p.length;AM<AL;AM++){I.removeNode(n,p[AM])}}if(b==P.move.TYPE_INNER){I.addNodes(AA,AF,AG)}else{I.addNodes(AA,AF.getParentNode(),AG);if(b==P.move.TYPE_PREV){for(AM=0,AL=AG.length;AM<AL;AM++){I.moveNode(AA,AF,AG[AM],b,false)}}else{for(AM=-1,AL=AG.length-1;AM<AL;AL--){I.moveNode(AA,AF,AG[AL],b,false)}}}}else{if(AD&&b==P.move.TYPE_INNER){I.addNodes(AA,AF,AG)}else{if(AD){I.addNodes(AA,AF.getParentNode(),AG)}if(b==P.move.TYPE_PREV){for(AM=0,AL=AG.length;AM<AL;AM++){I.moveNode(AA,AF,AG[AM],b,false)}}else{for(AM=-1,AL=AG.length-1;AM<AL;AL--){I.moveNode(AA,AF,AG[AL],b,false)}}}}for(AM=0,AL=AG.length;AM<AL;AM++){I.selectNode(AA,AG[AM],AM>0)}F("#"+AG[0].tId).focus().blur()}if(b==P.move.TYPE_INNER&&T.canAsync(AA,AF)){I.asyncNode(AA,AF,false,AH)}else{AH()}n.treeObj.trigger(P.event.DROP,[AK,AA.treeId,AG,AF,b,AD])}else{for(AI=0,AE=p.length;AI<AE;AI++){I.selectNode(AA,p[AI],AI>0)}n.treeObj.trigger(P.event.DROP,[AK,n.treeId,p,null,null,null])}}AC.bind("selectstart",c);function c(){return false}if(o.preventDefault){o.preventDefault()}return true}},H={getAbs:function(a){var b=a.getBoundingClientRect();return[b.left,b.top]},inputFocus:function(a){if(a.get(0)){a.focus();T.setCursorPosition(a.get(0),a.val().length)}},inputSelect:function(a){if(a.get(0)){a.focus();a.select()}},setCursorPosition:function(b,c){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,c)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",c);a.moveStart("character",c);a.select()}}},showIfameMask:function(h,f){var e=X.getRoot(h);while(e.dragMaskList.length>0){e.dragMaskList[0].remove();e.dragMaskList.shift()}if(f){var j=F("iframe");for(var d=0,b=j.length;d<b;d++){var c=j.get(d),a=T.getAbs(c),g=F("<div id='zTreeMask_"+d+"' class='zTreeMask' style='background-color:yellow;opacity: 0.3;filter: alpha(opacity=30);    top:"+a[1]+"px; left:"+a[0]+"px; width:"+c.offsetWidth+"px; height:"+c.offsetHeight+"px;'></div>");g.appendTo("body");e.dragMaskList.push(g)}}}},D={addEditBtn:function(b,c){if(c.editNameFlag||F("#"+c.tId+P.id.EDIT).length>0){return }if(!T.apply(b.edit.showRenameBtn,[b.treeId,c],b.edit.showRenameBtn)){return }var d=F("#"+c.tId+P.id.A),a="<span class='button edit' id='"+c.tId+P.id.EDIT+"' title='"+T.apply(b.edit.renameTitle,[b.treeId,c],b.edit.renameTitle)+"' treeNode"+P.id.EDIT+" style='display:none;'></span>";d.append(a);F("#"+c.tId+P.id.EDIT).bind("click",function(){if(!T.uCanDo(b)||T.apply(b.callback.beforeEditName,[b.treeId,c],true)==false){return false}I.editNode(b,c);return false}).show()},addRemoveBtn:function(a,b){if(b.editNameFlag||F("#"+b.tId+P.id.REMOVE).length>0){return }if(!T.apply(a.edit.showRemoveBtn,[a.treeId,b],a.edit.showRemoveBtn)){return }var d=F("#"+b.tId+P.id.A),c="<span class='button remove' id='"+b.tId+P.id.REMOVE+"' title='"+T.apply(a.edit.removeTitle,[a.treeId,b],a.edit.removeTitle)+"' treeNode"+P.id.REMOVE+" style='display:none;'></span>";d.append(c);F("#"+b.tId+P.id.REMOVE).bind("click",function(){if(!T.uCanDo(a)||T.apply(a.callback.beforeRemove,[a.treeId,b],true)==false){return false}I.removeNode(a,b);a.treeObj.trigger(P.event.REMOVE,[a.treeId,b]);return false}).bind("mousedown",function(e){return true}).show()},addHoverDom:function(a,b){if(X.getRoot(a).showHoverDom){b.isHover=true;if(a.edit.enable){I.addEditBtn(a,b);I.addRemoveBtn(a,b)}T.apply(a.view.addHoverDom,[a.treeId,b])}},cancelCurEditNode:function(f,d){var b=X.getRoot(f),e=f.data.key.name,g=b.curEditNode;if(g){var c=b.curEditInput;var a=d?d:c.val();if(!d&&T.apply(f.callback.beforeRename,[f.treeId,g,a],true)===false){g.editNameFlag=true;return false}else{g[e]=a?a:c.val();if(!d){f.treeObj.trigger(P.event.RENAME,[f.treeId,g])}}var h=F("#"+g.tId+P.id.A);h.removeClass(P.node.CURSELECTED_EDIT);c.unbind();I.setNodeName(f,g);g.editNameFlag=false;b.curEditNode=null;b.curEditInput=null;I.selectNode(f,g,false)}b.noSelection=true;return true},editNode:function(d,e){var a=X.getRoot(d);I.editNodeBlur=false;if(X.isSelectedNode(d,e)&&a.curEditNode==e&&e.editNameFlag){setTimeout(function(){T.inputFocus(a.curEditInput)},0);return }var c=d.data.key.name;e.editNameFlag=true;I.removeTreeDom(d,e);I.cancelCurEditNode(d);I.selectNode(d,e,false);F("#"+e.tId+P.id.SPAN).html("<input type=text class='rename' id='"+e.tId+P.id.INPUT+"' treeNode"+P.id.INPUT+" >");var b=F("#"+e.tId+P.id.INPUT);b.attr("value",e[c]);if(d.edit.editNameSelectAll){T.inputSelect(b)}else{T.inputFocus(b)}b.bind("blur",function(f){if(!I.editNodeBlur){I.cancelCurEditNode(d)}}).bind("keydown",function(f){if(f.keyCode=="13"){I.editNodeBlur=true;I.cancelCurEditNode(d,null,true)}else{if(f.keyCode=="27"){I.cancelCurEditNode(d,e[c])}}}).bind("click",function(f){return false}).bind("dblclick",function(f){return false});F("#"+e.tId+P.id.A).addClass(P.node.CURSELECTED_EDIT);a.curEditInput=b;a.noSelection=false;a.curEditNode=e},moveNode:function(m,d,p,c,AA,e){var r=X.getRoot(m),j=m.data.key.children;if(d==p){return }if(m.data.keep.leaf&&d&&!d.isParent&&c==P.move.TYPE_INNER){return }var u=(p.parentTId?p.getParentNode():r),o=(d===null||d==r);if(o&&d===null){d=r}if(o){c=P.move.TYPE_INNER}var a=(d.parentTId?d.getParentNode():r);if(c!=P.move.TYPE_PREV&&c!=P.move.TYPE_NEXT){c=P.move.TYPE_INNER}if(c==P.move.TYPE_INNER){if(o){p.parentTId=null}else{if(!d.isParent){d.isParent=true;d.open=!!d.open;I.setNodeLineIcos(m,d)}p.parentTId=d.tId}}var f,h;if(o){f=m.treeObj;h=f}else{if(!e&&c==P.move.TYPE_INNER){I.expandCollapseNode(m,d,true,false)}else{if(!e){I.expandCollapseNode(m,d.getParentNode(),true,false)}}f=F("#"+d.tId);h=F("#"+d.tId+P.id.UL);if(!h.get(0)){var y=[];I.makeUlHtml(m,d,y,"");f.append(y.join(""))}h=F("#"+d.tId+P.id.UL)}var w=F("#"+p.tId);if(h.get(0)&&c==P.move.TYPE_INNER){h.append(w)}else{if(f.get(0)&&c==P.move.TYPE_PREV){f.before(w)}else{if(f.get(0)&&c==P.move.TYPE_NEXT){f.after(w)}}}var t,s,g=-1,v=0,z=null,b=null,x=p.level;if(p.isFirstNode){g=0;if(u[j].length>1){z=u[j][1];z.isFirstNode=true}}else{if(p.isLastNode){g=u[j].length-1;z=u[j][g-1];z.isLastNode=true}else{for(t=0,s=u[j].length;t<s;t++){if(u[j][t].tId==p.tId){g=t;break}}}}if(g>=0){u[j].splice(g,1)}if(c!=P.move.TYPE_INNER){for(t=0,s=a[j].length;t<s;t++){if(a[j][t].tId==d.tId){v=t}}}if(c==P.move.TYPE_INNER){if(!d[j]){d[j]=new Array()}if(d[j].length>0){b=d[j][d[j].length-1];b.isLastNode=false}d[j].splice(d[j].length,0,p);p.isLastNode=true;p.isFirstNode=(d[j].length==1)}else{if(d.isFirstNode&&c==P.move.TYPE_PREV){a[j].splice(v,0,p);b=d;b.isFirstNode=false;p.parentTId=d.parentTId;p.isFirstNode=true;p.isLastNode=false}else{if(d.isLastNode&&c==P.move.TYPE_NEXT){a[j].splice(v+1,0,p);b=d;b.isLastNode=false;p.parentTId=d.parentTId;p.isFirstNode=false;p.isLastNode=true}else{if(c==P.move.TYPE_PREV){a[j].splice(v,0,p)}else{a[j].splice(v+1,0,p)}p.parentTId=d.parentTId;p.isFirstNode=false;p.isLastNode=false}}}X.fixPIdKeyValue(m,p);X.setSonNodeLevel(m,p.getParentNode(),p);I.setNodeLineIcos(m,p);I.repairNodeLevelClass(m,p,x);if(!m.data.keep.parent&&u[j].length<1){u.isParent=false;u.open=false;var n=F("#"+u.tId+P.id.UL),q=F("#"+u.tId+P.id.SWITCH),k=F("#"+u.tId+P.id.ICON);I.replaceSwitchClass(u,q,P.folder.DOCU);I.replaceIcoClass(u,k,P.folder.DOCU);n.css("display","none")}else{if(z){I.setNodeLineIcos(m,z)}}if(b){I.setNodeLineIcos(m,b)}if(!!m.check&&m.check.enable&&I.repairChkClass){I.repairChkClass(m,u);I.repairParentChkClassWithSelf(m,u);if(u!=p.parent){I.repairParentChkClassWithSelf(m,p)}}if(!e){I.expandCollapseParentNode(m,p.getParentNode(),true,AA)}},removeEditBtn:function(a){F("#"+a.tId+P.id.EDIT).unbind().remove()},removeRemoveBtn:function(a){F("#"+a.tId+P.id.REMOVE).unbind().remove()},removeTreeDom:function(a,b){b.isHover=false;I.removeEditBtn(b);I.removeRemoveBtn(b);T.apply(a.view.removeHoverDom,[a.treeId,b])},repairNodeLevelClass:function(b,d,c){if(c===d.level){return }var e=F("#"+d.tId),h=F("#"+d.tId+P.id.A),g=F("#"+d.tId+P.id.UL),a="level"+c,f="level"+d.level;e.removeClass(a);e.addClass(f);h.removeClass(a);h.addClass(f);g.removeClass(a);g.addClass(f)}},R={tools:H,view:D,event:Q,data:O};F.extend(true,F.fn.zTree.consts,Z);F.extend(true,F.fn.zTree._z,R);var B=F.fn.zTree,T=B._z.tools,P=B.consts,I=B._z.view,X=B._z.data,Q=B._z.event;X.exSetting(L);X.addInitBind(M);X.addInitCache(C);X.addInitNode(U);X.addInitProxy(N);X.addInitRoot(V);X.addZTreeTools(J);var S=I.cancelPreSelectedNode;I.cancelPreSelectedNode=function(c,d){var e=X.getRoot(c).curSelectedList;for(var b=0,a=e.length;b<a;b++){if(!d||d===e[b]){I.removeTreeDom(c,e[b]);if(d){break}}}if(S){S.apply(I,arguments)}};var W=I.createNodes;I.createNodes=function(c,d,b,a){if(W){W.apply(I,arguments)}if(!b){return }if(I.repairParentChkClassWithSelf){I.repairParentChkClassWithSelf(c,a)}};I.makeNodeUrl=function(a,b){return(b.url&&!a.edit.enable)?b.url:null};var A=I.removeNode;I.removeNode=function(b,c){var a=X.getRoot(b);if(a.curEditNode===c){a.curEditNode=null}if(A){A.apply(I,arguments)}};var Y=I.selectNode;I.selectNode=function(c,d,b){var a=X.getRoot(c);if(X.isSelectedNode(c,d)&&a.curEditNode==d&&d.editNameFlag){return false}if(Y){Y.apply(I,arguments)}I.addHoverDom(c,d);return true};var E=T.uCanDo;T.uCanDo=function(b,c){var a=X.getRoot(b);if(c&&(T.eqs(c.type,"mouseover")||T.eqs(c.type,"mouseout")||T.eqs(c.type,"mousedown")||T.eqs(c.type,"mouseup"))){return true}return(!a.curEditNode)&&(E?E.apply(I,arguments):true)}})(jQuery);